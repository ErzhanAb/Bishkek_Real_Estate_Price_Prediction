# Прогноз стоимости квартир в Бишкеке

Этот проект — интеллектуальная система для оценки рыночной стоимости недвижимости в Бишкеке. Он использует ансамбль из трех моделей машинного обучения для предоставления точного прогноза и 95% доверительного интервала.

Веб-приложение развернуто на Hugging Face Spaces с помощью Gradio.

---

## Ключевые особенности

-   **Ансамбль моделей**: Используется среднее предсказание от `CatBoost`, `RandomForest` и `SGDRegressor` для повышения точности и стабильности.
-   **Доверительные интервалы**: Каждая модель предоставляет 95% доверительный интервал, что дает представление о неопределенности прогноза.
-   **Геопространственная кластеризация**: Алгоритм `HDBSCAN` используется для автоматического определения районов города по координатам, что улучшает учет локации.
-   **Интерактивный интерфейс**: Удобное веб-приложение на Gradio для простого ввода данных и получения мгновенного результата.
-   **Обработка выбросов**: Данные очищены от аномальных значений для повышения качества моделей.

## Стек технологий

-   **Машинное обучение**: `scikit-learn`, `catboost`, `hdbscan`
-   **Обработка данных**: `pandas`, `numpy`
-   **Веб-интерфейс**: `Gradio`
-   **Развертывание**: `Hugging Face Spaces`

## Подход к моделированию

Для предсказания цены были обучены и объединены три различные модели.

### 1. CatBoostRegressor
-   **Основная модель**: `CatBoost` с гиперпараметрами, оптимизированными через `Optuna`.
-   **Доверительный интервал**: Две дополнительные модели `CatBoost` были обучены для предсказания 2.5% и 97.5% квантилей.
-   **Особенность**: Модель нативно работает с категориальными признаками без необходимости One-Hot Encoding.

### 2. RandomForestRegressor
-   **Основная модель**: `RandomForest` с гиперпараметрами, подобранными через `Optuna`.
-   **Доверительный интервал**: Рассчитывается на основе предсказаний всех деревьев в ансамбле (метод bootstrap по деревьям).

### 3. SGDRegressor с Bagging
-   **Основная модель**: `SGDRegressor` внутри пайплайна с `OneHotEncoder` и `StandardScaler`.
-   **Доверительный интервал**: Рассчитывается с помощью `BaggingRegressor`, обернутого вокруг `SGDRegressor`, что позволяет получить распределение предсказаний.

## Данные и их подготовка

-   **Источник**: Объявления о продаже квартир в Бишкеке с сайта `house.kg`.
-   **Очистка**:
    -   Удалены строки с пропущенными значениями в ключевых столбцах (площадь, комнаты, этаж, координаты).
    -   Устранены аномальные значения и выбросы по цене (например, квартиры с ценой, не соответствующей их площади).
-   **Feature Engineering**:
    -   **`hdbscan_cluster`**: Добавлен признак на основе гео-кластеризации (`HDBSCAN`) по широте и долготе. Это позволяет модели понимать различия между районами города.
-   **Предобработка**:
    -   Категориальные признаки кодируются с помощью `OneHotEncoder` для моделей `RandomForest` и `SGD`.

### Работа с гетероскедастичностью
В данных наблюдается гетероскедастичность (разброс ошибок зависит от цены). Эта проблема решается следующими методами:
-   Квантильная регрессия для CatBoost.
-   Бутстрэп по деревьям для RandomForest.
-   Бутстрэп по моделям для SGD (с помощью Bagging).

## Развертывание на Hugging Face Spaces

1.  Создайте новый Space на Hugging Face.
2.  Выберите **Gradio SDK** в качестве типа Space.
3.  Загрузите все файлы проекта в репозиторий Space.
4.  Создайте файл `requirements.txt` со следующим содержимым:

    ```pip
    gradio
    catboost
    scikit-learn
    numpy
    pandas
    joblib
    hdbscan
    ```
5.  Hugging Face автоматически установит зависимости и запустит `app.py`.

## Структура проекта
├── app.py
├── CatBoostRegressor_model.pkl
├── CatBoost_lower.pkl
├── CatBoost_upper.pkl
├── RandomForestRegressor_model.pkl
├── SGDRegressor_model.pkl
├── SGD_BaggingInterval.pkl
├── hdbscan_model.pkl
├── category_options.pkl
├── requirements.txt
└── README.md


### Назначение `.pkl` файлов

| Файл                    | Описание                                                                  |
| ----------------------- | ------------------------------------------------------------------------- |
| `*_model.pkl`           | Обученные модели для предсказания средней цены.                           |
| `*_lower/upper/Interval.pkl` | Модели для расчета 95% доверительного интервала.                       |
| `hdbscan_model.pkl`     | Используется для определения гео-кластера новых данных "на лету".         |
| `category_options.pkl`  | Содержит уникальные значения категорий для выпадающих списков в интерфейсе. |
